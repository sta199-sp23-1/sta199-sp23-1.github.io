{
  "hash": "51746e640d20ef8822f9d8dc6ce5a2ae",
  "result": {
    "markdown": "---\ntitle: \"Forensic genetic analysis\"\nsubtitle: \"STA 199\"\neditor: source\nformat: html\nexecute:\n  error: true\n---\n\n\n## Bulletin\n\n- this `ae` is **not** due for grade.\n- Project reports due today to Gradescope\n- [Team evaluation survey](https://forms.gle/MhSd8PWtSU3Jshvr9)\n- Statistics experience due today\n- course evaluations open. $>80\\%$ response $\\rightarrow$ +1pt final project\n- my final office hours today\n- public final project portfolio\n\n\n\n## Getting started\n\nClone *your* `ae27-username` repo from the [GitHub organization](https://github.com/orgs/sta199-sp23-1/repositories).\n\n\n## Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n## Background\n\nDNA evidence is sometimes used in court. In this AE, you will learn about the case of Dr. Schmidt from Lafayette, Louisiana, who was accused of infecting his former lover with HIV through a contaminated blood sample of one of his patients. Read more about this court case [here](https://www.wired.com/story/strands-of-evidence-genetic-testing-trial/) and [here](https://www.science.org/content/article/novel-dna-evidence-may-get-its-day-court).\n\n## Today\n\nBy the end of today you will\n\n-   be able to critical think about the use of DNA evidence and statistics in court\n\n-   analyze non-numerical data rigorously\n\n## Explore the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf_HIV = read_csv(\"https://sta101-fa22.netlify.app/static/appex/data/HIV.csv\")\n```\n:::\n\n\n`df_HIV` contains several observations of HIV genomes. Within this data set are two samples with special ids: `sample1` and `sample2`. \n\nFor the purpose of this exercise, you might imagine `sample1` is associated with the HIV sampled from the plaintiff while `sample2` belongs to that of the defendant's patient.\n\nFundamentally, we are interested in whether or not `sample1` and `sample2` are closely related.\n\n#### Exercise 1\n\n-   how many observations are present in the data set?\n\n-   what are the observational units?\n\n-   how many bases does the first DNA sequence contain? Hint: use the `R` function `nchar`.\n\n## Extracting a sub-sequence of DNA\n\nFor computational speed, we will have to work with shorter sub-sequences of DNA.\n\nThe function `str_sub` from the package `stringr` in the `tidyverse` can be used to extract a sub-string from a character vector.\n\n#### Exercise 2\n\n-   how many arguments does the function `str_sub` take? What does each argument do?\n\n-   use `str_sub` to extract (i) the first four letters of the words *statistics*, (ii) the sub-string between the third and the seventh letters, and (iii) the last four letters\n\n\n::: {.cell}\n\n```{.r .cell-code}\nterm = \"statistics\"\n```\n:::\n\n\n\nLet's use `str_sub` to extract the first 500 bases from the DNA sequences using the template below.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHIV = df_HIV %>% \n  mutate(dna_short = ___) %>%\n  select(-dna)\n```\n:::\n\n\n-   use `nchar` to verify that each sub-sequence `dna_short` contains 500 bases. Hint: `nchar` is vectorized, meaning if given a vector input, it will return a vector output.\n\n## Computing the pairwise distances between the DNA sequence\n\nNow that the data have been prepared, we will establish how similar/different each DNA sequence is to the others. To accomplish this, given two DNA sequences we will count the number of bases for which they differ. The rationale for this step is the following. If two DNA differ on many bases, it means that they have evolved separately for a while and had the time to undergo numerous mutations. On the other hand, if they only differ on a few bases, it means that the two sequences have only recently began to evolve separately.\n\nThe following code creates a data frame where each row corresponds to a pair of DNA sequences.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_pairs <- combn(HIV$person_id, 2) %>%\n  t() %>% # go from wide matrix (2 rows) to long matrix (2 columns)\n  as_tibble() %>%\n  rename(id1 = V1, id2 = V2) %>%\n  left_join(HIV, by = c(\"id1\" = \"person_id\")) %>% # add dna for person 1\n  rename(dna1 = dna_short) %>%\n  left_join(HIV, by = c(\"id2\" = \"person_id\")) %>% # add dna for person 1\n  rename(dna2 = dna_short)\n```\n:::\n\n\nCheck the dimensions of `d_pairs`\n\n### Hamming distance\n\nTo measure the distance between two sequences, we first consider the Hamming distance\n\n\n$$\nd(i,j) = \\sum_{k=1}^n 1\\{\\text{dna}_{ik} \\neq \\text{dna}_{jk}\\} \n$$\n\n\nwhich counts the number of elements that are different between two sequences. Here $d(i,j)$ denotes the Hamming distance between sequences $i$ and $j$, and $1\\{\\text{dna}_{ik} \\neq \\text{dna}_{jk}\\}$ is equal to $1$ is the $k$-th element of sequence $i$ is different from that of sequence $j$.\n\nThe following code computes the Hamming distance between each pair of sequences. We first construct function `compute_hamming` which computes the Hamming distance between two DNA sequences. We then apply this function to each row of the `d_pairs` data frame.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncompute_hamming <- function(dna1, dna2) {\n  \n  dna1_split <- str_split(dna1, pattern = \"\", simplify = TRUE)\n  dna2_split <- str_split(dna2, pattern = \"\", simplify = TRUE)\n  \n  hamming_distance <- sum(dna1_split != dna2_split)\n  return(hamming_distance)\n}\n\nd_hamming <- d_pairs %>%\n  mutate(\n    distance_ham = list(dna1, dna2) %>% pmap_dbl(compute_hamming)\n  )\n```\n:::\n\n\n#### Exercise 3\n\n- Make a histogram of the Hamming distances and describe the distribution.\n\n\n::: {.cell}\n\n:::\n\n\n- Find the 10 pairs of DNA sequences that are the closest to the plaintiff's sequence in terms of Hamming distance.\n\n\n::: {.cell}\n\n:::\n\n\n- Which sequence is most closely related to the plaintiff's sequence?\n\n- How many differences are there between the DNA sequence of the plaintiff and that of the defendant's patient?\n\n- Can you identify a shortcoming of the Hamming distance? Does a large Hamming distance necessarily imply that the two DNA sequences are very different?\n\n### An alternative measure of distance for DNA sequences\n\nLet us now consider an alternative measure of distance for DNA sequences.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_biology <- d_pairs %>%\n  mutate(\n    distance_bio = list(dna1, dna2) %>% pmap_dbl(adist)\n    )\n```\n:::\n\n\n#### Exercise 4\n\n- Again, make a histogram of the new distance and find the 10 DNA sequences closest to the plaintiff's.\n\n\n::: {.cell}\n\n:::\n\n\n- Which of the two measures do you find more adequate for these data?\n\n#### Exercise 5\n\n- Imagine that you are a juror in this court case, would you find this piece of evidence convincing? Would you like to have more information? If so, what additional information would you need? Now, imagine that you are a judge; do you think that this piece of evidence should be admitted to court? Why?",
    "supporting": [
      "ae-27_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}