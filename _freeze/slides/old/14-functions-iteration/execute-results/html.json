{
  "hash": "21fae5896642afc7736b04b4a1c78b2a",
  "result": {
    "markdown": "---\ntitle: \"Functions and iteration\"\nsubtitle: \"Lecture 14\"\ndate: \"October 18, 2022\"\nformat: revealjs\n---\n\n\n# Warm up\n\n\n::: {.cell}\n\n:::\n\n\n## While you wait for class to begin...\n\nClone your `ae-11` project from GitHub, render your document, update your name, and commit and push.\n\n## Announcements\n\n-   Project proposals due Friday\n-   No in person OH today (but I'll be at majors fair!). OH on Zoom 8-9pm tonight (Tuesday) and Wednesday. Will email reminder with Zoom link + add to OH sheet.\n-   Make sure to review the video/reading for Thursday!\n\n## Midterm feedback followup\n\n> Can be difficult to catch up on AEs if bits are missed.\n\nWill post AE solutions after class instead of waiting for the deadline.\nYou still need to attempt them to get points.\n\n# From last time\n\n## Recap of `ae-10`\n\n-   Use the SelectorGadget identify tags for elements you want to grab\n-   Use rvest to first read the whole page (into R) and then parse the object you've read in to the elements you're interested in\n-   Put the components together in a data frame (a tibble) and analyze it like you analyze any other data\n\n## A new R workflow {.smaller}\n\n-   When working in a Quarto document, your analysis is re-run each time you knit\n\n-   If web scraping in a Quarto document, you'd be re-scraping the data each time you knit, which is undesirable (and not *nice*)!\n\n-   An alternative workflow:\n\n    -   Use an R script to save your code\n    -   Saving interim data scraped using the code in the script as CSV or RDS files\n    -   Use the saved data in your analysis in your Quarto document\n\n## Ethics: \"Can you?\" vs \"Should you?\"\n\n![](images/13/ok-cupid-1.png){fig-align=\"center\" width=\"800\"}\n\n::: aside\nSource: Brian Resnick, [Researchers just released profile data on 70,000 OkCupid users without permission](https://www.vox.com/2016/5/12/11666116/70000-okcupid-users-data-release), Vox.\n:::\n\n## \"Can you?\" vs \"Should you?\"\n\n![](images/13/ok-cupid-2.png){fig-align=\"center\" width=\"800\"}\n\n## Challenges: Unreliable formatting\n\n![](images/13/unreliable-formatting.png){fig-align=\"center\" width=\"699\"}\n\n::: aside\n[alumni.duke.edu/news/notable-alumni](https://alumni.duke.edu/news/notable-alumni)\n:::\n\n## Challenges: Data broken into many pages\n\n![](images/13/many-pages.png){fig-align=\"center\"}\n\n## Workflow: Screen scraping vs. APIs\n\nTwo different scenarios for web scraping:\n\n-   Screen scraping: extract data from source code of website, with html parser (easy) or regular expression matching (less easy)\n\n-   Web APIs (application programming interface): website offers a set of structured http requests that return JSON or XML files\n\n# Functions\n\n## Functions in R\n\n::: question\nWhat are some functions you've learned?\nWhat are their inputs, what are their outputs?\n:::\n\n## `mean()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- c(1, 2, 3, 4, 5)\nmean(x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3\n```\n:::\n:::\n\n\n## Custom function: `multiply_by_two()` {.smaller}\n\n::: incremental\n-   Decide on a goal: Multiply by two\n-   Decide on the number and type of inputs: 1 (a numeric vector of length 1)\n-   Decide on the number and type of outputs: 1 (a numeric vector of length 1)\n:::\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmultiply_by_two <- function(x){\n  x * 2\n}\n```\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmultiply_by_two(1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2\n```\n:::\n\n```{.r .cell-code}\nmultiply_by_two(2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 4\n```\n:::\n\n```{.r .cell-code}\nmultiply_by_two(3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 6\n```\n:::\n:::\n\n\n## Custom function: `multiply()` {.smaller}\n\n::: incremental\n-   Decide on a goal: Multiply by a given value\n-   Decide on the number and type of inputs: 2 (two numeric vectors of length 1)\n-   Decide on the number and type of outputs: 1 (a numeric vector of length 1)\n:::\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmultiply <- function(x, y){\n  x * y\n}\n```\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmultiply(1, 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 3\n```\n:::\n\n```{.r .cell-code}\nmultiply(2, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 10\n```\n:::\n\n```{.r .cell-code}\nmultiply(10, 35)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 350\n```\n:::\n:::\n\n\n## Custom function: `temp_convert()`\n\n-   Goal: Convert temperatures in degrees Fahrenheit to Celsius; subtract 32 and multiply by $\\frac{5}{9}$.\n-   Number and type of inputs: 1 (a numeric vector of length 1)\n-   Number and type of outputs: 1 (a numeric vector of length 1)\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp_convert <- function(temp_f){\n  (temp_f - 32) * 5/9\n}\n```\n:::\n\n\n## Test out the function\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp_convert(32)   # freezing point\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp_convert(360)  # cake baking temperature\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 182.2222\n```\n:::\n:::\n\n\n. . .\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntemp_convert(98.6) # body temperature\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 37\n```\n:::\n:::\n\n\n## Why do we need functions?\n\n::: columns\n::: {.column width=\"50%\"}\n**Repeat yourself:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# freezing point\n(32 - 32) * (5/9)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n\n```{.r .cell-code}\n# cake baking temperature\n(360 - 32) * (5/9)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 182.2222\n```\n:::\n\n```{.r .cell-code}\n# body temperature\n(98.6 - 32) * (5/9)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 37\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n**Do not repeat yourself (DRY):**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# freezing point\ntemp_convert(32)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0\n```\n:::\n\n```{.r .cell-code}\n# cake baking temperature\ntemp_convert(360)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 182.2222\n```\n:::\n\n```{.r .cell-code}\n# body temperature\ntemp_convert(98.6)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 37\n```\n:::\n:::\n\n:::\n:::\n\n## Seriously, DRY! {.smaller}\n\nLoad package:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\n. . .\n\nDefine input vector:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- c(32, 360, 98.6)\nx\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]  32.0 360.0  98.6\n```\n:::\n:::\n\n\n::: columns\n::: {.fragment .column width=\"50%\"}\n**Map** your function over the elements of the input vector:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap(x, temp_convert)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[[1]]\n[1] 0\n\n[[2]]\n[1] 182.2222\n\n[[3]]\n[1] 37\n```\n:::\n:::\n\n:::\n\n::: {.fragment .column width=\"50%\"}\n**Control** the type of your output:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_dbl(x, temp_convert)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1]   0.0000 182.2222  37.0000\n```\n:::\n:::\n\n:::\n:::\n\n## Iteration\n\nTo apply the same function to multiple values (stored in an object like a vector), use `map()` functions:\n\n::: incremental\n-   `map()` returns a list\n\n-   `map_lgl()`, `map_int()`, `map_dbl()` and `map_chr()` return an atomic vector of the indicated type (logical, integer, double, or character, respectively)\n\n-   `map_dfr()` and `map_dfc()` return a data frame created by row-binding and column-binding, respectively\n:::\n\n## Coming soon...\n\n::: incremental\n-   **Use** a function that takes a data frame and names of variables in that data frame\n-   Fits a regression model for predicting one specified variable from the others given\n-   Reports the model results along with measurements on prediction error and other diagnostic values\n:::\n\n## Coming now\n\n::: incremental\n-   **Write** a function that scrapes data from a single page and outputs a data frame with items of interest from that page\n-   Map that function over multiple pages to get a bigger data frame with items of interest from all pages\n-   Items of interest: Amazon reviews of Yankee Candles\n:::\n\n# Application exercise\n\n## Yankee Candle reviews and COVID\n\n[![](images/14/og-candle-review-tweet.png){fig-align=\"center\" width=\"600\"}](https://twitter.com/kate_ptrv/status/1332398737604431874?s=20)\n\n::: aside\nSource: [\\@kate_ptrv on Twitter](https://twitter.com/kate_ptrv/status/1332398737604431874?s=20) + [GitHub](https://github.com/kateptrv/Candles)\n:::\n\n## Goal\n\n::: columns\n::: {.column width=\"50%\"}\n-   Scrape data **from multiple pages** and organize it in a tidy format in R\n-   Perform light text parsing to clean data\n-   Summarize and visualize the data\n:::\n\n::: {.column width=\"50%\"}\n![](images/14/yc.png){fig-align=\"center\" width=\"601\"}\n:::\n:::\n\n## `ae-11`\n\n::: appex\n::: nonincremental\n-   Go to the course [GitHub org](https://github.com/sta199-f22-1) and find your `ae-11` (repo name will be suffixed with your GitHub name).\n-   Clone the repo in your container, open the Quarto document in the repo, and follow along and complete the exercises.\n-   Render, commit, and push your edits by the AE deadline -- 3 days from today.\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}